<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Petite √âcole">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#2d6a4f">
<title>La Petite √âcole</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #fdf6e3;
    --green: #2d6a4f;
    --green-light: #52b788;
    --green-pale: #d8f3dc;
    --yellow: #f4a261;
    --red: #e76f51;
    --blue: #457b9d;
    --text: #1d3557;
    --shadow: 0 4px 20px rgba(0,0,0,0.10);
  }
  * { box-sizing:border-box; margin:0; padding:0; }
  body { font-family:'Nunito',sans-serif; background:var(--bg); color:var(--text); min-height:100vh;
    min-height: -webkit-fill-available;
    padding-bottom: env(safe-area-inset-bottom);
    padding-top: env(safe-area-inset-top);
    background-image:repeating-linear-gradient(45deg,transparent,transparent 40px,rgba(45,106,79,.03) 40px,rgba(45,106,79,.03) 80px); }

  h1 { font-family:'Fredoka One',cursive; font-size:2.6rem; color:var(--green); text-align:center;
    padding:1.4rem 1rem .2rem; text-shadow:3px 3px 0 var(--green-pale); }
  .subtitle { text-align:center; color:var(--green-light); font-weight:700; margin-bottom:1.2rem; font-size:.9rem; }

  /* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
  .tabs { display:flex; max-width:900px; margin:0 auto 1rem; padding:0 1rem; gap:.5rem; }
  .tab-btn { flex:1; padding:.55rem; border:2px solid var(--green-pale); border-radius:12px; background:white;
    font-family:'Fredoka One',cursive; font-size:1rem; color:var(--green); cursor:pointer; transition:all .15s; }
  .tab-btn.active { background:var(--green); color:white; border-color:var(--green); }
  .tab-btn:hover:not(.active) { border-color:var(--green-light); }

  /* ‚îÄ‚îÄ SETUP ‚îÄ‚îÄ */
  #setup { max-width:480px; margin:0 auto; padding:0 1.5rem 2rem; }
  .setup-card { background:white; border-radius:20px; padding:2rem; box-shadow:var(--shadow); border:2px solid var(--green-pale); }
  .setup-card h2 { font-family:'Fredoka One',cursive; color:var(--green); margin-bottom:1.3rem; font-size:1.3rem; text-align:center; }
  .player-count-btns { display:flex; gap:.6rem; justify-content:center; flex-wrap:wrap; margin-bottom:1.6rem; }
  .count-btn { width:52px; height:52px; border-radius:50%; border:3px solid var(--green-pale); background:white;
    font-family:'Fredoka One',cursive; font-size:1.3rem; color:var(--green); cursor:pointer; transition:all .15s; }
  .count-btn:hover { border-color:var(--green-light); transform:scale(1.08); }
  .count-btn.active { background:var(--green); color:white; border-color:var(--green); }
  .player-inputs { display:flex; flex-direction:column; gap:.7rem; margin-bottom:1.6rem; }
  .player-input-row { display:flex; align-items:center; gap:.8rem; }
  .player-emoji { font-size:1.5rem; width:36px; text-align:center; }
  .player-input-row input { flex:1; padding:.6rem 1rem; border-radius:12px; border:2px solid var(--green-pale);
    font-family:'Nunito',sans-serif; font-size:1rem; font-weight:700; color:var(--text); outline:none; transition:border-color .15s; }
  .player-input-row input:focus { border-color:var(--green-light); }
  .btn-start { width:100%; padding:.9rem; background:var(--green); color:white; border:none; border-radius:14px;
    font-family:'Fredoka One',cursive; font-size:1.3rem; cursor:pointer; transition:all .15s; box-shadow:0 4px 12px rgba(45,106,79,.3); }
  .btn-start:hover { background:#235c41; transform:translateY(-2px); }

  /* ‚îÄ‚îÄ GAME ‚îÄ‚îÄ */
  #game { display:none; max-width:900px; margin:0 auto; padding:0 1rem 3rem; }
  .players-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(255px,1fr)); gap:1rem; margin-bottom:1.1rem; }

  .player-card { background:white; border-radius:20px; padding:1.1rem 1.3rem; box-shadow:var(--shadow); border:2px solid var(--green-pale); }
  .player-card.opened { border-color:var(--green-light); background:linear-gradient(135deg,#f0fff4,white); }

  .pc-header { display:flex; align-items:center; gap:.7rem; margin-bottom:.85rem; }
  .pc-emoji { font-size:1.7rem; }
  .pc-name { font-family:'Fredoka One',cursive; font-size:1.1rem; color:var(--green); }
  .dealer-tag { background:var(--yellow); color:white; font-size:.65rem; font-weight:900; border-radius:6px;
    padding:.1rem .4rem; margin-left:.3rem; text-transform:uppercase; }
  .pc-year { margin-left:auto; background:var(--green-pale); color:var(--green); border-radius:20px; padding:.15rem .7rem; font-weight:800; font-size:.82rem; }

  .pc-stats { display:flex; gap:.5rem; margin-bottom:.85rem; }
  .stat-box { flex:1; background:var(--bg); border-radius:10px; padding:.4rem .5rem; text-align:center; }
  .stat-label { font-size:.62rem; font-weight:700; color:#999; text-transform:uppercase; letter-spacing:.5px; }
  .stat-value { font-family:'Fredoka One',cursive; font-size:1.15rem; color:var(--text); }

  .pts-input { width:100%; padding:.55rem .8rem; border-radius:10px; border:2px solid var(--green-pale);
    font-family:'Nunito',sans-serif; font-size:1rem; font-weight:800; color:var(--text); outline:none;
    text-align:center; transition:border-color .15s; margin-bottom:.6rem; }
  .pts-input:focus { border-color:var(--yellow); }
  .pts-input::placeholder { color:#ccc; font-weight:600; }

  .pc-actions { display:flex; gap:.5rem; }
  .btn-open { flex:1; padding:.5rem; background:var(--green-pale); color:var(--green); border:2px solid var(--green-light);
    border-radius:10px; font-family:'Fredoka One',cursive; font-size:.88rem; cursor:pointer; transition:all .15s; }
  .btn-open.active { background:var(--green); color:white; }

  .round-actions { display:flex; justify-content:center; gap:.7rem; flex-wrap:wrap; margin-top:.8rem; }
  .btn-next-round { padding:.8rem 2rem; background:var(--blue); color:white; border:none; border-radius:14px;
    font-family:'Fredoka One',cursive; font-size:1.1rem; cursor:pointer; box-shadow:0 4px 12px rgba(69,123,157,.3); transition:all .15s; }
  .btn-next-round:hover { background:#2d5f7a; transform:translateY(-2px); }
  .btn-challenges { padding:.8rem 1.4rem; background:white; color:var(--green); border:2px solid var(--green-light);
    border-radius:14px; font-family:'Fredoka One',cursive; font-size:1.1rem; cursor:pointer; transition:all .15s; }
  .btn-challenges:hover { background:var(--green-pale); }
  .btn-reset { padding:.8rem 1.2rem; background:white; color:var(--red); border:2px solid var(--red);
    border-radius:14px; font-family:'Fredoka One',cursive; font-size:1.1rem; cursor:pointer; transition:all .15s; }
  .btn-reset:hover { background:#fff0ee; }

  /* ‚îÄ‚îÄ CHALLENGES MODAL ‚îÄ‚îÄ */
  .modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,.45); z-index:200;
    align-items:flex-end; justify-content:center; }
  .modal-overlay.open { display:flex; }
  .modal-box { background:white; border-radius:24px 24px 0 0; width:100%; max-width:660px;
    max-height:88vh; overflow-y:auto; padding:1.2rem 1.4rem 2.5rem;
    box-shadow:0 -8px 40px rgba(0,0,0,.2); animation:slideUp .25s ease; }
  @keyframes slideUp { from{transform:translateY(100%)} to{transform:translateY(0)} }
  .modal-handle { width:40px; height:5px; background:#ddd; border-radius:3px; margin:0 auto 1rem; }
  .modal-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem; flex-wrap:wrap; gap:.6rem; }
  .modal-title { font-family:'Fredoka One',cursive; font-size:1.4rem; color:var(--green); }
  .modal-close { background:none; border:none; font-size:1.8rem; cursor:pointer; color:#bbb; line-height:1; }
  .modal-close:hover { color:var(--red); }

  .toggle-all-btn { display:flex; align-items:center; gap:.4rem; background:var(--green-pale); border:none;
    border-radius:10px; padding:.35rem .85rem; font-family:'Nunito',sans-serif; font-weight:800;
    font-size:.82rem; color:var(--green); cursor:pointer; transition:all .15s; }
  .toggle-all-btn:hover { background:var(--green); color:white; }
  .toggle-all-btn.all-shown { background:var(--green); color:white; }

  .challenge-group { margin-bottom:.75rem; border-radius:14px; overflow:hidden; border:2px solid var(--green-pale); }
  .ch-header { background:var(--green); color:white; padding:.55rem 1rem;
    display:flex; align-items:center; gap:.6rem; font-family:'Fredoka One',cursive; font-size:1rem; }
  .ch-cards { background:rgba(255,255,255,.22); border-radius:20px; padding:.05rem .55rem;
    font-size:.78rem; font-family:'Nunito',sans-serif; font-weight:800; }
  .ch-who { font-size:.75rem; opacity:.8; margin-left:auto; font-family:'Nunito',sans-serif; font-weight:700; }
  .ch-body { background:white; padding:.65rem 1rem; font-size:.95rem; font-weight:700; color:var(--text); line-height:1.5; }
  .ch-key { color:var(--green); }

  /* ‚îÄ‚îÄ LEADERBOARD ‚îÄ‚îÄ */
  #leaderboard { display:none; max-width:600px; margin:0 auto; padding:0 1rem 3rem; }
  .lb-card { background:white; border-radius:20px; box-shadow:var(--shadow); border:2px solid var(--green-pale); overflow:hidden; }
  .lb-head { background:var(--green); color:white; padding:.8rem 1.4rem; font-family:'Fredoka One',cursive; font-size:1rem;
    display:grid; grid-template-columns:48px 40px 1fr 110px 80px; align-items:center; gap:.5rem; }
  .lb-row { display:grid; grid-template-columns:48px 40px 1fr 110px 80px; align-items:center; gap:.5rem;
    padding:.75rem 1.4rem; border-bottom:1px solid var(--green-pale); }
  .lb-row:last-child { border-bottom:none; }
  .lb-row.top1 { background:#fffde7; }
  .lb-row.top2 { background:#f8f8f8; }
  .lb-row.top3 { background:#fff8f4; }
  .lb-rank { font-family:'Fredoka One',cursive; font-size:1.4rem; text-align:center; }
  .lb-emoji { font-size:1.6rem; }
  .lb-name { font-family:'Fredoka One',cursive; font-size:1.05rem; color:var(--green); }
  .lb-year-wrap { display:flex; flex-direction:column; gap:.3rem; }
  .lb-year-badge { background:var(--green-pale); color:var(--green); border-radius:20px; padding:.1rem .6rem; font-weight:800; font-size:.8rem; display:inline-block; }
  .lb-bar-bg { height:7px; background:#eee; border-radius:4px; }
  .lb-bar { height:100%; background:var(--green-light); border-radius:4px; transition:width .5s; }
  .lb-pts { font-family:'Fredoka One',cursive; font-size:1.15rem; color:var(--red); text-align:right; }

  /* ‚îÄ‚îÄ WIN ‚îÄ‚îÄ */
  #win-screen { display:none; text-align:center; padding:2rem 1rem 4rem; }
  .win-emoji { font-size:5rem; animation:bounce .8s infinite alternate; }
  @keyframes bounce { from{transform:translateY(0)} to{transform:translateY(-16px)} }
  .win-title { font-family:'Fredoka One',cursive; font-size:2.3rem; color:var(--green); margin:.5rem 0; }
  .win-name { font-family:'Fredoka One',cursive; font-size:1.7rem; color:var(--yellow); margin-bottom:1rem; }
  .win-table { max-width:420px; margin:0 auto; background:white; border-radius:16px; overflow:hidden; box-shadow:var(--shadow); }
  .win-table table { width:100%; border-collapse:collapse; }
  .win-table th { background:var(--green); color:white; padding:.6rem 1rem; font-family:'Fredoka One',cursive; font-size:.9rem; }
  .win-table td { padding:.6rem 1rem; border-bottom:1px solid var(--green-pale); font-weight:700; font-size:.95rem; }
  .win-table tr:last-child td { border-bottom:none; }
  .win-table .rank1 td { background:#fffde7; }
  .btn-play-again { margin-top:1.5rem; padding:.9rem 2.5rem; background:var(--green); color:white; border:none;
    border-radius:14px; font-family:'Fredoka One',cursive; font-size:1.3rem; cursor:pointer;
    box-shadow:0 4px 12px rgba(45,106,79,.3); transition:all .15s; }
  .btn-play-again:hover { background:#235c41; transform:translateY(-2px); }

  /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
  .toast { position:fixed; bottom:2rem; left:50%; transform:translateX(-50%) translateY(80px); background:var(--text);
    color:white; padding:.65rem 1.4rem; border-radius:30px; font-weight:700; font-size:.9rem;
    box-shadow:0 4px 20px rgba(0,0,0,.2); transition:transform .3s; z-index:999; white-space:nowrap; }
  .toast.show { transform:translateX(-50%) translateY(0); }
</style>
</head>
<body>

<!-- ‚ïê‚ïê SETUP ‚ïê‚ïê -->
<div id="setup">
  <h1>üéí La Petite √âcole</h1>
  <p class="subtitle">Calculateur de points</p>
  <div class="setup-card">
    <h2>Combien de joueurs ?</h2>
    <div class="player-count-btns" id="count-btns">
      <button class="count-btn" onclick="selectCount(2)">2</button>
      <button class="count-btn" onclick="selectCount(3)">3</button>
      <button class="count-btn active" onclick="selectCount(4)">4</button>
      <button class="count-btn" onclick="selectCount(5)">5</button>
      <button class="count-btn" onclick="selectCount(6)">6</button>
    </div>
    <div class="player-inputs" id="player-inputs"></div>
    <button class="btn-start" onclick="startGame()">üéÆ Commencer la partie !</button>
  </div>
</div>

<!-- ‚ïê‚ïê GAME WRAPPER ‚ïê‚ïê -->
<div id="game-wrapper" style="display:none">
  <h1>üéí La Petite √âcole</h1>
  <p class="subtitle">Tour <span id="round-subtitle">1</span> ‚Äî <span id="cards-subtitle">11</span> cartes &bull; Donne : <span id="dealer-subtitle">‚Äî</span></p>

  <div class="tabs">
    <button class="tab-btn active" id="tab-game" onclick="switchTab('game')">üéÆ Tour en cours</button>
    <button class="tab-btn" id="tab-lb" onclick="switchTab('leaderboard')">üèÜ Classement</button>
  </div>

  <!-- GAME TAB -->
  <div id="game">
    <div class="players-grid" id="players-grid"></div>
    <div class="round-actions">
      <button class="btn-next-round" onclick="nextRound()">üîÑ Tour suivant</button>
      <button class="btn-challenges" onclick="openChallenges()">üìñ D√©fis</button>
      <button class="btn-reset" onclick="confirmReset()">‚Ü© Nouvelle partie</button>
    </div>
  </div>

  <!-- LEADERBOARD TAB -->
  <div id="leaderboard">
    <div class="lb-card">
      <div class="lb-head">
        <span></span><span></span><span>Joueur</span><span>Progression</span><span style="text-align:right">Points</span>
      </div>
      <div id="lb-rows"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê CHALLENGES MODAL ‚ïê‚ïê -->
<div class="modal-overlay" id="challenges-overlay" onclick="overlayClick(event)">
  <div class="modal-box">
    <div class="modal-handle"></div>
    <div class="modal-header">
      <div class="modal-title">üìñ Les d√©fis</div>
      <div style="display:flex;gap:.5rem;align-items:center;">
        <button class="toggle-all-btn" id="toggle-all-btn" onclick="toggleAllYears()">Toutes les ann√©es</button>
        <button class="modal-close" onclick="closeChallenges()">√ó</button>
      </div>
    </div>
    <div id="challenges-list"></div>
  </div>
</div>

<!-- ‚ïê‚ïê WIN ‚ïê‚ïê -->
<div id="win-screen">
  <div class="win-emoji">üèÜ</div>
  <div class="win-title">Partie termin√©e !</div>
  <div class="win-name" id="win-name"></div>
  <div class="win-table" id="win-table"></div>
  <button class="btn-play-again" onclick="resetGame()">üéÆ Rejouer !</button>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ
const EMOJIS = ['ü¶ä','üêª','ü¶Å','üê∏','ü¶ã','üêº'];

const CHALLENGES = [
  { year:1,  cards:11, desc:'<span class="ch-key">1 suite de 4</span> + <span class="ch-key">1 trio</span>' },
  { year:2,  cards:12, desc:'<span class="ch-key">1 suite de 4</span> + <span class="ch-key">2 trios</span>' },
  { year:3,  cards:13, desc:'<span class="ch-key">1 suite de 3</span> + <span class="ch-key">3 trios</span>' },
  { year:4,  cards:14, desc:'<span class="ch-key">3 suites de 3</span> + <span class="ch-key">1 trio</span>' },
  { year:5,  cards:15, desc:'<span class="ch-key">1 suite de 5</span> + <span class="ch-key">2 trios</span>' },
  { year:6,  cards:16, desc:'<span class="ch-key">1 suite de 3</span> + <span class="ch-key">2 fois 4 pareilles</span>' },
  { year:7,  cards:17, desc:'<span class="ch-key">1 suite de 7</span> + <span class="ch-key">2 trios</span>' },
  { year:8,  cards:18, desc:'<span class="ch-key">3 suites de 5</span> + <span class="ch-key">1 trio</span>' },
  { year:9,  cards:19, desc:'<span class="ch-key">1 suite de 3</span> + <span class="ch-key">3 fois 5 pareilles</span>' },
  { year:10, cards:20, desc:'<span class="ch-key">1 suite de 10</span> + <span class="ch-key">3 trios</span>' },
];

let playerCount = 4;
let players = [];
let round = 1;
let dealerIndex = 0;
let showAllYears = false;

// ‚îÄ‚îÄ SETUP ‚îÄ‚îÄ
function selectCount(n) {
  playerCount = n;
  document.querySelectorAll('.count-btn').forEach((b,i) => b.classList.toggle('active', i+2===n));
  buildInputs();
}

function buildInputs() {
  const defaults = ['Sylvie','Hubert','Carole','Dany','Eva','Fran√ßois'];
  const c = document.getElementById('player-inputs');
  c.innerHTML = '';
  for (let i = 0; i < playerCount; i++) {
    c.innerHTML += `<div class="player-input-row">
      <div class="player-emoji">${EMOJIS[i]}</div>
      <input type="text" id="pname-${i}" placeholder="${defaults[i]}" value="${defaults[i]}" maxlength="16">
    </div>`;
  }
}

function startGame() {
  players = [];
  for (let i = 0; i < playerCount; i++) {
    const name = document.getElementById(`pname-${i}`).value.trim() || `Joueur ${i+1}`;
    players.push({ name, emoji: EMOJIS[i], year: 1, totalPts: 0, opened: false });
  }
  round = 1; dealerIndex = 0;
  document.getElementById('setup').style.display = 'none';
  document.getElementById('game-wrapper').style.display = 'block';
  switchTab('game');
  renderGame();
}

// ‚îÄ‚îÄ TABS ‚îÄ‚îÄ
function switchTab(tab) {
  document.getElementById('game').style.display = tab==='game' ? 'block' : 'none';
  document.getElementById('leaderboard').style.display = tab==='leaderboard' ? 'block' : 'none';
  document.getElementById('tab-game').classList.toggle('active', tab==='game');
  document.getElementById('tab-lb').classList.toggle('active', tab==='leaderboard');
  if (tab==='leaderboard') renderLeaderboard();
}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ
function maxYear() { return Math.max(...players.map(p => p.year)); }
function cardsCount() { return 10 + maxYear(); }

function updateSubtitle() {
  document.getElementById('round-subtitle').textContent = round;
  document.getElementById('cards-subtitle').textContent = cardsCount();
  document.getElementById('dealer-subtitle').textContent = players[dealerIndex % players.length].name;
}

// ‚îÄ‚îÄ RENDER GAME ‚îÄ‚îÄ
function renderGame() {
  updateSubtitle();
  const grid = document.getElementById('players-grid');
  grid.innerHTML = '';
  players.forEach((p, i) => {
    const isDealer = (dealerIndex % players.length) === i;
    grid.innerHTML += `
      <div class="player-card ${p.opened?'opened':''}" id="pc-${i}">
        <div class="pc-header">
          <div class="pc-emoji">${p.emoji}</div>
          <div><div class="pc-name">${p.name}${isDealer?'<span class="dealer-tag">Donne</span>':''}</div></div>
          <div class="pc-year">üìö Ann√©e ${p.year}</div>
        </div>
        <div class="pc-stats">
          <div class="stat-box">
            <div class="stat-label">Points total</div>
            <div class="stat-value">${p.totalPts}</div>
          </div>
        </div>
        <input class="pts-input" id="pts-${i}" type="number" min="0"
          inputmode="numeric" pattern="[0-9]*"
          placeholder="Points restants ce tour‚Ä¶">
        <div class="pc-actions">
          <button class="btn-open ${p.opened?'active':''}" onclick="toggleOpen(${i})">
            ${p.opened?'‚úì A ouvert':'üéØ A ouvert ?'}
          </button>
        </div>
      </div>`;
  });
}

function toggleOpen(i) {
  players[i].opened = !players[i].opened;
  renderGame();
}

// ‚îÄ‚îÄ NEXT ROUND ‚îÄ‚îÄ
function nextRound() {
  players.forEach((p, i) => {
    const val = parseInt(document.getElementById(`pts-${i}`)?.value) || 0;
    p.totalPts += val;
  });

  const winners = players.filter(p => p.opened && p.year >= 10);
  if (winners.length > 0) {
    showWin();
    return;
  }

  players.forEach(p => { if (p.opened && p.year < 10) p.year++; });
  players.forEach(p => { p.opened = false; });
  round++;
  dealerIndex++;
  renderGame();
  showToast(`Tour ${round} ‚Äî ${cardsCount()} cartes √† distribuer`);
}

// ‚îÄ‚îÄ CHALLENGES MODAL ‚îÄ‚îÄ
function openChallenges() {
  showAllYears = false;
  document.getElementById('toggle-all-btn').classList.remove('all-shown');
  renderChallenges();
  document.getElementById('challenges-overlay').classList.add('open');
}

function closeChallenges() {
  document.getElementById('challenges-overlay').classList.remove('open');
}

function overlayClick(e) {
  if (e.target === document.getElementById('challenges-overlay')) closeChallenges();
}

function toggleAllYears() {
  showAllYears = !showAllYears;
  document.getElementById('toggle-all-btn').classList.toggle('all-shown', showAllYears);
  renderChallenges();
}

function renderChallenges() {
  // Active years: unique years among players
  const activeYears = [...new Set(players.map(p => p.year))].sort((a,b)=>a-b);

  const filtered = showAllYears
    ? CHALLENGES
    : CHALLENGES.filter(c => activeYears.includes(c.year));

  const list = document.getElementById('challenges-list');
  list.innerHTML = filtered.map(c => {
    // Which players are at this year?
    const who = players.filter(p => p.year === c.year).map(p => `${p.emoji} ${p.name}`).join(', ');
    return `
      <div class="challenge-group">
        <div class="ch-header">
          <span>Ann√©e ${c.year}</span>
          <span class="ch-cards">${c.cards} cartes</span>
          ${who ? `<span class="ch-who">${who}</span>` : ''}
        </div>
        <div class="ch-body">${c.desc}</div>
      </div>`;
  }).join('');

  if (filtered.length === 0) {
    list.innerHTML = '<p style="text-align:center;color:#aaa;padding:1rem;font-weight:700;">Aucun d√©fi √† afficher</p>';
  }
}

// ‚îÄ‚îÄ LEADERBOARD ‚îÄ‚îÄ
function renderLeaderboard() {
  const sorted = [...players].sort((a,b) => b.year!==a.year ? b.year-a.year : a.totalPts-b.totalPts);
  const ranks = ['ü•á','ü•à','ü•â'];
  document.getElementById('lb-rows').innerHTML = sorted.map((p,idx) => `
    <div class="lb-row ${idx===0?'top1':idx===1?'top2':idx===2?'top3':''}">
      <div class="lb-rank">${idx<3?ranks[idx]:idx+1}</div>
      <div class="lb-emoji">${p.emoji}</div>
      <div class="lb-name">${p.name}</div>
      <div class="lb-year-wrap">
        <span class="lb-year-badge">Ann√©e ${p.year} / 10</span>
        <div class="lb-bar-bg"><div class="lb-bar" style="width:${p.year*10}%"></div></div>
      </div>
      <div class="lb-pts">${p.totalPts} pts</div>
    </div>`).join('');
}

// ‚îÄ‚îÄ WIN ‚îÄ‚îÄ
function showWin() {
  const sorted = [...players].sort((a,b) => b.year!==a.year ? b.year-a.year : a.totalPts-b.totalPts);
  document.getElementById('game-wrapper').style.display = 'none';
  document.getElementById('win-screen').style.display = 'block';
  const w = sorted[0];
  document.getElementById('win-name').textContent = `${w.emoji} ${w.name} a gagn√© !`;
  const ranks = ['ü•á','ü•à','ü•â'];
  document.getElementById('win-table').innerHTML = `<table>
    <thead><tr><th>Rang</th><th>Joueur</th><th>Ann√©e</th><th>Points</th></tr></thead>
    <tbody>${sorted.map((p,i) => `<tr class="${i===0?'rank1':''}">
      <td>${i<3?ranks[i]:i+1}</td><td>${p.emoji} ${p.name}</td><td>${p.year}</td><td>${p.totalPts}</td>
    </tr>`).join('')}</tbody></table>`;
}

// ‚îÄ‚îÄ RESET ‚îÄ‚îÄ
function confirmReset() { if(confirm('Recommencer une nouvelle partie ?')) resetGame(); }
function resetGame() {
  document.getElementById('win-screen').style.display = 'none';
  document.getElementById('game-wrapper').style.display = 'none';
  document.getElementById('setup').style.display = 'block';
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

selectCount(4);
</script>
</body>
</html>
